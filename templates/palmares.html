{% extends 'base.html' %}

{% block head %}
<title>Palmarès</title>
{% endblock %}

{% block body %}
<div class="content">


    <div class="description">
        <h3 style="text-align: center">Palmares des magasins en France en Euros, de tous les indicateurs, pour toutes les familles de produit, pour toutes les enseignes, pour le mois de {{mois}} {{current_year}}, classés par {{ classement_indicator }} </h3>
    </div>


    <div class="filtre">
        <form action="/palmares" method="POST">
        
            <label for="mois-select">Année</label>
            <select name="annee" id="mois-select">
                <option value="2020">--Choix de l'année--</option>
                <option value="2020">2020</option>
                <option value="2021">2021</option>
            </select></br>
            
            <label for="mois-select">Mois</label>
            <select name="mois" id="mois-select">
                <option value="1|janvier">--Choix du mois--</option>
                <option value="1|janvier">janvier</option>
                <option value="2|février">février</option>
                <option value="3|mars">mars</option>
                <option value="4|avril">avril</option>
                <option value="5|mai">mai</option>
                <option value="6|juin">juin</option>
            </select></br>
    
            <label for="classement-select">Ordre</label>
            <select name="classement" id="mois-select">
                <option value="ca_reel">--Choix de l'indicateur de classement--</option>
                <option value="ca_reel">CA réel</option>
                <option value="ca_objectif">CA objectif</option>
                <option value="vente_reel">Vente réel</option>
                <option value="ventes_objectif">Vente objectif</option>
                <option value="marge_reel">Marge réelle</option>
                <option value="marge_objectif">Marge objectif</option>
            </select></br>
    
            <input type="submit" value="Envoyer" />
        </form>
    </div>


    <div class="palmares">

    <table>
        <tr>
            <th></th>
            <th colspan="3"> CA </th>
            <th colspan="3"> Ventes </th>
            <th colspan="3"> Marge </th>
            <th rowspan="2"> Rang National </th>
            <th rowspan="2"> Rang année précédente National </th>
            <th rowspan="2"> Evolution National </th>
            <th rowspan="2"> Rang Régional </th>
            <th rowspan="2"> Rang année précédente Régional </th>
            <th rowspan="2"> Evolution Régional </th>
        </tr>

        <tr>
            <th>Ville</th>
            <th>Budget</th><th>Reel</th><th>Ratio</th>
            <th>Budget</th><th>Reel</th><th>Ratio</th>
            <th>Budget</th><th>Reel</th><th>Ratio</th>
        </tr>

        {% for i in pi %}
            {% set city_pi = pi[loop.index-1] %}
            {% set city_pi_prev = pi_prev[loop.index-1] %}
            <tr>
                <th>{{ city_pi[0] }}</th>
                <td> {{ '{0:0.2f}'.format(city_pi[1]) }}</td>
                <td> {{ '{0:0.2f}'.format(city_pi[2]) }}</td>
                <td> {{ '{0:0.2f}'.format(city_pi[2]/city_pi[1]) }}</td>
                <td> {{ '{0:0.2f}'.format(city_pi[3]) }}</td>
                <td> {{ '{0:0.2f}'.format(city_pi[4]) }}</td>
                <td> {{ '{0:0.2f}'.format(city_pi[4]/city_pi[3]) }}</td>
                <td> {{ '{0:0.2f}'.format(city_pi[5]) }}</td>
                <td> {{ '{0:0.2f}'.format(city_pi[6]) }}</td>
                <td> {{ '{0:0.2f}'.format(city_pi[6]/city_pi[5]) }}</td>
                <td>{{ loop.index }}</td>
                <td>{{ ranks[city_pi[0]] }}</td>
                {% if ranks[city_pi[0]] is defined %}
                    {% if ranks[city_pi[0]]-loop.index == 0 %}
                        <td> = </td>
                    {% elif ranks[city_pi[0]]-loop.index > 0 %}
                        <td>+{{ ranks[city_pi[0]]-loop.index}}</td>
                    {% else %}
                        <td>{{ ranks[city_pi[0]]-loop.index}}</td>
                    {% endif %}
                {% endif %}
                
            </tr>
        {% endfor %}

    </table>

    </div>
    



</div>
{% endblock %}


